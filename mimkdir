#!/bin/sh

TOP_DIR=$(cd $(dirname $0);pwd)
DATA_DIR="$TOP_DIR/data"
ICONS_DIR="$TOP_DIR/icons"
IMAGES_DIR="$TOP_DIR/images"

if [[ "$1" == *@* ]]; then
    type=$(echo $1 | cut -d '@' -f 2)
    name=$(echo $1 | cut -d '@' -f 1)
    icon=$(cat $DATA_DIR/folderIcons.json | awk -f $TOP_DIR/main.awk -v target="$type")
else
    name=$1
    icon=$(cat $DATA_DIR/folderIcons.json | awk -f $TOP_DIR/main.awk -v target="$1")
fi

if [ -z $icon ]; then
    mkdir ./$1
else
    if [ ! -f $IMAGES_DIR/$icon.png ]; then
        rsvg-convert -h 120 $ICONS_DIR/$icon.svg > $IMAGES_DIR/$icon.png
    fi
    mkdir ./$name && fileicon -q set ./$name $IMAGES_DIR/$icon.png
fi
